%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PACKAGE IMPORTS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \usepackage[sfdefault]{roboto}
% \usepackage[T1]{fontenc}
% \usepackage[utf8]{inputenc}

\usepackage[tmargin=3cm,rmargin=1in,lmargin=1in,margin=0.85in,bmargin=3cm]{geometry}
\usepackage{amsmath,amsfonts,amsthm,amssymb,mathtools}
\usepackage{diffcoeff} 
\usepackage{xfrac}
\usepackage[makeroom]{cancel}
\usepackage{bookmark}
\usepackage{enumitem}
\usepackage{hyperref,theoremref}
\hypersetup{
	colorlinks=true,
  allcolors=fg,
	bookmarksnumbered=true,
	bookmarksopen=true
}
\usepackage[most,many,breakable]{tcolorbox}
\usepackage{xcolor}
\usepackage{varwidth}
\usepackage{etoolbox}
\usepackage{nameref}
\usepackage{multicol,array}
\usepackage{tikz-cd}
\usepackage{algorithm}
\usepackage{algpseudocode}
%\usepackage[ruled,vlined,linesnumbered]{algorithm2e}
\usepackage{booktabs}
\usepackage{comment}
\usepackage{import}
\usepackage{xifthen}
\usepackage{pdfpages}
\usepackage{transparent}
\usepackage{caption}
\usepackage{marginnote}
\usepackage{float}
\usepackage{tikz}
\usepackage{tikzsymbols}
\usetikzlibrary{patterns, shapes.misc}
\usepackage{pgfplots}
\pgfplotsset{compat=1.18}
\usepackage{xpatch}% to patch \cancel
\usepackage{forest}

% \usepackage{graphicx}
% \graphicspath{ {./images/} }

\makeatletter
\xpatchcmd{\canto@vector}{\vector}{\line}{}{}
\makeatother

% removing algorithm numbering
\renewcommand{\thealgorithm}{}

% don't know what this is
% \newcommand\mycommfont[1]{\footnotesize\ttfamily\textcolor{blue}{#1}}
% \SetCommentSty{mycommfont}
% \newcommand{\incfig}[1]{%
%     \def\svgwidth{\columnwidth}
%     \import{./figures/}{#1.pdf_tex}
% }

\newcommand{\tikzmark}[1]{\tikz[overlay,remember picture] \node (#1) {};}

\tikzset{cross/.style={cross out, draw=black, minimum size=2*(#1-\pgflinewidth), inner sep=0pt, outer sep=0pt}, cross/.default={4.5pt}}

\forestset{
  declare toks={elo}{}, % Edge Label Options
  anchors/.style={anchor=#1,child anchor=#1,parent anchor=#1},
  dot/.style={tikz+={\fill (.child anchor) circle[radius=#1];}},
  dot/.default=2pt,
  decision edge label/.style n args=3{
    edge label/.expanded={node[midway,auto=#1,anchor=#2,\forestoption{elo}]{\strut$\unexpanded{#3}$}}
  },
  decision/.style={if n=1
    {decision edge label={left}{north}{#1}}
    {decision edge label={right}{south}{#1}}
  },
  decision tree/.style={
    for tree={
      grow=east,
      calign angle=45,
      calign=fixed edge angles,
      s sep=0.5em,l=4ex,
      if n children=0{anchors=south}{
        if n=1{anchors=north}{anchors=south}},
      math content,
    },
    anchors=east, outer sep=2pt,
    delay={for descendants={split option={content}{;}{content,decision}}},
  },
    decision tree nodes/.style={
    for tree={
      grow=east,
      calign angle=45,
      calign=fixed edge angles,
      s sep=0.5em,l=4ex,
      if n children=0{anchors=west}{
        if n=1{anchors=north}{anchors=south}},
      math content,
    },
    anchors=east, outer sep=2pt,
    dot=2pt,for descendants=dot,
    delay={for descendants={split option={content}{;}{content,decision}}},
  },
}

% \renewcommand\qedsymbol{$\Laughey$}   %uncomment to use smile as qedsymbol


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% COLORS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\definecolor{bg}{HTML}{F2F2F2}
\definecolor{fg}{HTML}{282828}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% MARGINS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\setlength{\parindent}{0pt}

% change default chapter distance
\makeatletter
% --- Patch \chapter
\patchcmd{\@makechapterhead}{50\p@}{\chapheadtopskip}{}{}% Space from top of page to CHAPTER X
\patchcmd{\@makechapterhead}{20\p@}{\chapheadsep}{}{}% Space between CHAPTER X and CHAPTER TITLE
\patchcmd{\@makechapterhead}{40\p@}{\chapheadbelowskip}{}{}% Space between CHAPTER TITLE and text
% --- Patch \chapter*
\patchcmd{\@makeschapterhead}{50\p@}{\chapheadtopskip}{}{}% Space from top of page to CHAPTER TITLE
\patchcmd{\@makeschapterhead}{40\p@}{\chapheadbelowskip}{}{}% SPace between CHAPTER TITLE and text
\makeatother
% Set new lengths
\newlength{\chapheadtopskip}\setlength{\chapheadtopskip}{0pt}
\newlength{\chapheadsep}\setlength{\chapheadsep}{15pt}
\newlength{\chapheadbelowskip}\setlength{\chapheadbelowskip}{25pt}

%================================
% THEOREM BOX
%================================
\tcbuselibrary{theorems,skins,hooks}
\newtcbtheorem[number within=chapter]{Theorem}{Theorem}
{%
	enhanced,
	breakable,
	colback = bg,
	frame hidden,
	boxrule = 0sp,
	borderline west = {2pt}{0pt}{fg!85!bg},
	sharp corners,
	detach title,
	before upper = \tcbtitle\par\smallskip,
	coltitle = fg!85!bg,
	fonttitle = \sffamily,
	description font = \mdseries,
	separator sign none,
	segmentation style={solid, fg},
}
{th}
\tcbuselibrary{theorems,skins,hooks}
\newtcbtheorem[number within=chapter]{theorem}{Theorem}
{%
	enhanced,
	breakable,
	colback = bg,
	frame hidden,
	boxrule = 0sp,
	borderline west = {2pt}{0pt}{fg!85!bg},
	sharp corners,
	detach title,
	before upper = \tcbtitle\par\smallskip,
	coltitle = fg!85!bg,
	fonttitle = \sffamily,
	description font = \mdseries,
	separator sign none,
	segmentation style={solid, fg},
}
{th}


%================================
% Corollary
%================================
\tcbuselibrary{theorems,skins,hooks}
\newtcbtheorem[number within=chapter]{Corollary}{Corollary}
{%
	enhanced,
	breakable,
	colback = bg,
	frame hidden,
	boxrule = 0sp,
	borderline west = {2pt}{0pt}{fg!70!bg},
	sharp corners,
	detach title,
	before upper = \tcbtitle\par\smallskip,
	coltitle = fg!70!bg,
	fonttitle = \sffamily,
	description font = \mdseries,
	separator sign none,
	segmentation style={solid, fg},
}
{th}
\tcbuselibrary{theorems,skins,hooks}
\newtcbtheorem[number within=chapter]{corollary}{Corollary}
{%
	enhanced,
	breakable,
	colback = bg,
	frame hidden,
	boxrule = 0sp,
	borderline west = {2pt}{0pt}{fg!70!bg},
	sharp corners,
	detach title,
	before upper = \tcbtitle\par\smallskip,
	coltitle = fg!70!bg,
	fonttitle = \sffamily,
	description font = \mdseries,
	separator sign none,
	segmentation style={solid, fg},
}
{th}

%================================
% LEMMA
%================================
\tcbuselibrary{theorems,skins,hooks}
\newtcbtheorem[number within=chapter]{Lemma}{Lemma}
{%
	enhanced,
	breakable,
	colback = bg,
	frame hidden,
	boxrule = 0sp,
	borderline west = {2pt}{0pt}{fg!70!bg},
	sharp corners,
	detach title,
	before upper = \tcbtitle\par\smallskip,
	coltitle = fg!70!bg,
	fonttitle = \sffamily,
	description font = \mdseries,
	separator sign none,
	segmentation style={solid, fg},
}
{th}
\tcbuselibrary{theorems,skins,hooks}
\newtcbtheorem[number within=chapter]{lemma}{Lemma}
{%
	enhanced,
	breakable,
	colback = bg,
	frame hidden,
	boxrule = 0sp,
	borderline west = {2pt}{0pt}{fg!70!bg},
	sharp corners,
	detach title,
	before upper = \tcbtitle\par\smallskip,
	coltitle = fg!70!bg,
	fonttitle = \sffamily,
	description font = \mdseries,
	separator sign none,
	segmentation style={solid, fg},
}
{th}

%================================
% PROPERTY
%================================
\tcbuselibrary{theorems,skins,hooks}
\newtcbtheorem[number within=chapter]{Prop}{Property}
{%
	enhanced,
	breakable,
	colback = bg,
	frame hidden,
	boxrule = 0sp,
	sharp corners,
	detach title,
	before upper = \tcbtitle\par\smallskip,
	coltitle = fg,
	fonttitle = \sffamily,
	description font = \mdseries,
	separator sign none,
	segmentation style={solid, fg},
}
{th}
\tcbuselibrary{theorems,skins,hooks}
\newtcbtheorem[number within=chapter]{prop}{Property}
{%
	enhanced,
	breakable,
	colback = bg,
	frame hidden,
	boxrule = 0sp,
	sharp corners,
	detach title,
	before upper = \tcbtitle\par\smallskip,
	coltitle = fg,
	fonttitle = \sffamily,
	description font = \mdseries,
	separator sign none,
	segmentation style={solid, fg},
}
{th}


%================================
% CLAIM
%================================
\tcbuselibrary{theorems,skins,hooks}
\newtcbtheorem[number within=chapter]{claim}{Claim}
{%
	enhanced,
	breakable,
	colback = bg,
	frame hidden,
	boxrule = 0sp,
	borderline west = {2pt}{0pt}{fg},
	sharp corners,
	detach title,
	before upper = \tcbtitle\par\smallskip,
	coltitle = fg,
	fonttitle = \sffamily,
	description font = \mdseries,
	separator sign none,
	segmentation style={solid, fg},
}
{th}

%================================
% Exercise
%================================
\tcbuselibrary{theorems,skins,hooks}
\newtcbtheorem[number within=chapter]{Exercise}{Exercise}
{%
	enhanced,
	breakable,
	colback = bg,
	frame hidden,
	boxrule = 0sp,
	sharp corners,
	detach title,
	before upper = \tcbtitle\par\smallskip,
	coltitle = fg,
	fonttitle = \sffamily,
	description font = \mdseries,
	separator sign none,
	segmentation style={solid, fg},
}
{th}
\tcbuselibrary{theorems,skins,hooks}
\newtcbtheorem[number within=chapter]{exercise}{Exercise}
{%
	enhanced,
	breakable,
	colback = bg,
	frame hidden,
	boxrule = 0sp,
	sharp corners,
	detach title,
	before upper = \tcbtitle\par\smallskip,
	coltitle = fg,
	fonttitle = \sffamily,
	description font = \mdseries,
	separator sign none,
	segmentation style={solid, fg},
}
{th}

%================================
% EXAMPLE BOX
%================================

\newtcbtheorem[number within=chapter]{Example}{Example}
{%
	enhanced,
	breakable,
	colback = bg,
	frame hidden,
	boxrule = 0sp,
	sharp corners,
	detach title,
	before upper = \tcbtitle\par\smallskip,
	coltitle = fg,
	fonttitle = \sffamily,
	description font = \mdseries,
	separator sign none,
	segmentation style={solid, fg},
}
{ex}
\newtcbtheorem[number within=chapter]{example}{Example}
{%
	enhanced,
	breakable,
	colback = bg,
	frame hidden,
	boxrule = 0sp,
	sharp corners,
	detach title,
	before upper = \tcbtitle\par\smallskip,
	coltitle = fg,
	fonttitle = \sffamily,
	description font = \mdseries,
	separator sign none,
	segmentation style={solid, fg},
}
{ex}


%================================
% DEFINITION BOX
%================================

\tcbuselibrary{theorems,skins,hooks}
\newtcbtheorem[number within=chapter]{Definition}{Definition}
{%
	enhanced,
	breakable,
	colback = bg,
	frame hidden,
	boxrule = 0sp,
	borderline west = {2pt}{0pt}{fg},
	sharp corners,
	detach title,
	before upper = \tcbtitle\par\smallskip,
	coltitle = fg,
	fonttitle = \sffamily,
	description font = \mdseries,
	separator sign none,
	segmentation style={solid, fg},
}
{def}
\tcbuselibrary{theorems,skins,hooks}
\newtcbtheorem[number within=chapter]{definition}{Definition}
{%
	enhanced,
	breakable,
	colback = bg,
	frame hidden,
	boxrule = 0sp,
	borderline west = {2pt}{0pt}{fg},
	sharp corners,
	detach title,
	before upper = \tcbtitle\par\smallskip,
	coltitle = fg,
	fonttitle = \sffamily,
	description font = \mdseries,
	separator sign none,
	segmentation style={solid, fg},
}
{def}

%================================
% QUESTION BOX
%================================

\makeatletter
\newtcbtheorem{question}{Question}
{%
	enhanced,
	breakable,
	colback = bg,
	frame hidden,
	boxrule = 0sp,
	borderline = {0.5pt}{0pt}{fg},
	rounded corners,
	detach title,
	before upper = \tcbtitle\par\smallskip,
	coltitle = fg,
	fonttitle = \sffamily,
	description font = \mdseries,
	separator sign none,
	segmentation style={solid, fg},
}
{def}
\makeatother

%================================
% SOLUTION BOX
%================================

\makeatletter
\newtcbtheorem{solution}{Solution}
{%
	enhanced,
	breakable,
	colback = bg,
	frame hidden,
	boxrule = 0sp,
	borderline west = {2pt}{0pt}{fg},
	sharp corners,
	detach title,
	before upper = \tcbtitle\par\smallskip,
	coltitle = fg,
	fonttitle = \sffamily,
	description font = \mdseries,
	separator sign none,
	segmentation style={solid, fg},
}
{def}
\makeatother

%================================
% NOTE BOX
%================================

\usetikzlibrary{arrows,calc,shadows.blur}
\tcbuselibrary{skins}
\newtcolorbox{note}[1][]{%
	enhanced jigsaw,
	colback=bg,
	colframe=fg,
	size=small,
	boxrule=1pt,
  title=\textbf{\textbf{NOTE:}},
	before upper = \tcbtitle\par,
	detach title,
	coltitle=fg,
	breakable,
	drop shadow=fg!50!bg,
	#1,
}

%================================
% EXAM EXERCISE
%================================

\tcbuselibrary{theorems}
\newtcolorbox[auto counter]{examexercise}[1][]{%
  colback = white,
  colbacktitle = white,
  coltitle = black,
  center title,
	frame hidden,
	colframe = white,
	boxrule = 0sp,
  fonttitle = \sffamily,
  title={\textbf{Exercise \thetcbcounter}},
  #1,
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SELF MADE COMMANDS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% non numbered
\newcommand{\dfn}[2]{\begin{definition*}{#1}{}#2\end{definition*}}
\newcommand{\thm}[2]{\begin{theorem*}{#1}{}#2\end{theorem*}}
\newcommand{\cor}[2]{\begin{corollary*}{#1}{}#2\end{corollary*}}
\newcommand{\lem}[2]{\begin{lemma*}{#1}{}#2\end{lemma*}}
\newcommand{\pro}[2]{\begin{prop*}{#1}{}#2\end{prop*}}
\newcommand{\clm}[3]{\begin{claim*}{#1}{#2}#3\end{claim*}}
\newcommand{\exs}[3]{\begin{exercise*}{#1}{#2}#3\end{exercise*}}
\newcommand{\exa}[2]{\begin{example*}{#1}{}#2\end{example*}}
\newcommand{\qs}[2]{\begin{question*}{#1}{}#2\end{question*}}
\newcommand{\sol}[2]{\begin{solution*}{#1}{}#2\end{solution*}}
\newcommand{\prf}[2]{\begin{myproof}{#1}{}#2\end{myproof}}
\newcommand{\nt}[1]{\begin{note}#1\end{note}}

% numbered
\newcommand{\ndfn}[2]{\begin{definition}{#1}{}#2\end{definition}}
\newcommand{\nthm}[2]{\begin{theorem}{#1}{}#2\end{theorem}}
\newcommand{\ncor}[2]{\begin{corollary}{#1}{}#2\end{corollary}}
\newcommand{\nlem}[2]{\begin{lemma}{#1}{}#2\end{lemma}}
\newcommand{\npro}[2]{\begin{prop}{#1}{}#2\end{prop}}
\newcommand{\nclm}[3]{\begin{claim}{#1}{#2}#3\end{claim}}
\newcommand{\nexs}[3]{\begin{exercise}{#1}{#2}#3\end{exercise}}
\newcommand{\nexa}[2]{\begin{example}{#1}{}#2\end{example}}

% exam title
\newcommand{\inlinemaketitle}{{\let\newpage\relax\maketitle}}
\newcommand{\examex}[1]{\begin{examexercise}#1\end{examexercise}}

\newcommand*\circled[1]{\tikz[baseline=(char.base)]{
		\node[shape=circle,draw,inner sep=1pt] (char) {#1};}}
\newcommand\getcurrentref[1]{%
	\ifnumequal{\value{#1}}{0}
	{??}
	{\the\value{#1}}%
}
\newcommand{\getCurrentSectionNumber}{\getcurrentref{section}}
\newenvironment{myproof}[2][\proofname]{%
	\proof[\textnormal{\textbf{PROOF  }}\itshape #2:]$ $\par\nobreak\ignorespaces
}{\endproof}

\newcommand{\mclm}[2]{\begin{myclaim}[#1]#2\end{myclaim}}
\newenvironment{myclaim}[1][\claimname]{\proof[ #1: ]}{}

\newcounter{mylabelcounter}

\makeatletter
\newcommand{\setword}[2]{%
	\phantomsection
	#1\def\@currentlabel{\unexpanded{#1}}\label{#2}%
}
\makeatother


\tikzset{
	symbol/.style={
			draw=none,
			every to/.append style={
					edge node={node [sloped, allow upside down, auto=false]{$#1$}}}
		}
}

% deliminators
\DeclarePairedDelimiter{\abs}{\lvert}{\rvert}
\DeclarePairedDelimiter{\norm}{\lVert}{\rVert}

\DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}
\DeclarePairedDelimiter{\floor}{\lfloor}{\rfloor}
\DeclarePairedDelimiter{\round}{\lfloor}{\rceil}

\newsavebox\diffdbox
\newcommand{\slantedromand}{{\mathpalette\makesl{d}}}
\newcommand{\makesl}[2]{%
\begingroup
\sbox{\diffdbox}{$\mathsurround=0pt#1\mathrm{#2}$}%
\pdfsave
\pdfsetmatrix{1 0 0.2 1}%
\rlap{\usebox{\diffdbox}}%
\pdfrestore
\hskip\wd\diffdbox
\endgroup
}
\newcommand{\dd}[1][]{\ensuremath{\mathop{}\!\ifstrempty{#1}{%
\slantedromand\@ifnextchar^{\hspace{0.2ex}}{\hspace{0.1ex}}}%
{\slantedromand\hspace{0.2ex}^{#1}}}}
\ProvideDocumentCommand\dv{o m g}{%
  \ensuremath{%
    \IfValueTF{#3}{%
      \IfNoValueTF{#1}{%
        \frac{\dd #2}{\dd #3}%
      }{%
        \frac{\dd^{#1} #2}{\dd #3^{#1}}%
      }%
    }{%
      \IfNoValueTF{#1}{%
        \frac{\dd}{\dd #2}%
      }{%
        \frac{\dd^{#1}}{\dd #2^{#1}}%
      }%
    }%
  }%
}
\providecommand*{\pdv}[3][]{\frac{\partial^{#1}#2}{\partial#3^{#1}}}
\DeclareMathOperator{\Lap}{\mathcal{L}}
\DeclareMathOperator{\Var}{Var} % varience
\DeclareMathOperator{\Cov}{Cov} % covarience
\DeclareMathOperator{\E}{E} % expected

\let\oldleq\leq
\let\oldgeq\geq
\renewcommand{\leq}{\leqslant}
\renewcommand{\geq}{\geqslant}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% TABLE OF CONTENTS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{titletoc}
\contentsmargin{0cm}
\titlecontents{part}[-1pc]
{\addvspace{50pt}%
	\begin{tikzpicture}[remember picture, overlay]%
		\draw[fill=fg!85,draw=fg!85] (-4.5,-0.2) rectangle (-0.15,0.55);%
		\pgftext[left,x=-1.6cm,y=0.15cm]{\color{bg}\Large Part}%
	\end{tikzpicture}\color{fg}\large}
{}
{}
{}
\titlecontents{chapter}[5pc]
{\addvspace{30pt}%
	\begin{tikzpicture}[remember picture, overlay]%
		\draw[fill=fg!85,draw=fg!85] (-3.6,-0.2) rectangle (-0.12,0.55);%
		\pgftext[left,x=-3.5cm,y=0.15cm]{\color{bg}\Large Chapter\ \thecontentslabel}%
	\end{tikzpicture}\color{fg}\large}%
{}
{}
{\;\titlerule\;\large Page \thecontentspage
	\begin{tikzpicture}[remember picture, overlay]
		\draw[fill=fg,draw=fg] (4pt,0.2pt) rectangle (4,0.2pt);
	\end{tikzpicture}}%
\titlecontents{section}[5pc]
{\addvspace{2pt}}
{\contentslabel[\thecontentslabel]{2pc}}
{}
{\hfill\small \thecontentspage}
[]
\titlecontents{subsection}[5pc]
{\addvspace{2pt}}
{\scriptsize$\bullet$\quad\small}
{}
{\hfill\small}
% {\hfill\small \thecontentspage}
[]

\makeatletter
\renewcommand{\tableofcontents}{%
	\chapter*{%
	  \vspace*{-20\p@}%
	  \begin{tikzpicture}[remember picture, overlay]%
		  \pgftext[right,x=16.7cm,y=0.2cm]{\color{fg!85}\Huge \contentsname}%
		  \draw[fill=fg!85,draw=fg!85] (14.6,-0.65) rectangle (20,1);%
		  \clip (14.6,-0.65) rectangle (20,1);
		  \pgftext[right,x=16.7cm,y=0.2cm]{\color{bg}\Huge \contentsname}%
	  \end{tikzpicture}}%
	\@starttoc{toc}}
\makeatother
